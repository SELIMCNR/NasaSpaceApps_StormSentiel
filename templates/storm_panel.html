<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AQI Panel - TEMPO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f7f7f7;
      }
      .nav-link {
        transition: all 0.2s;
      }
      .nav-link.active {
        border-color: #4f46e5;
        color: #4f46e5;
        font-weight: 600;
      }
    </style>
    <script>
      // Veri gÃ¼ncelleme sÃ¼recinde kullanÄ±cÄ±ya geri bildirim saÄŸlamak iÃ§in
      function updateData() {
        const button = document.getElementById("updateButton");
        button.disabled = true;
        button.innerHTML =
          '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Veriler GÃ¼ncelleniyor... (LÃ¼tfen Bekleyin)';

        // GerÃ§ek gÃ¼ncelleme isteÄŸini yap
        window.location.href = "{{ url_for('update_data') }}";
      }

      function getColorClass(aqi) {
        if (aqi === "N/A") return "text-gray-500 bg-gray-100";
        const score = parseInt(aqi);
        if (score <= 50) return "text-green-700 bg-green-100"; // Ä°yi
        if (score <= 100) return "text-yellow-700 bg-yellow-100"; // Orta
        if (score <= 150) return "text-orange-700 bg-orange-100"; // Hassas
        if (score <= 200) return "text-red-700 bg-red-100"; // SaÄŸlÄ±ksÄ±z
        return "text-purple-700 bg-purple-100"; // Ã‡ok SaÄŸlÄ±ksÄ±z
      }

      window.onload = function () {
        const aqiElement = document.getElementById("avgAqiScore");
        const aqiValue = aqiElement.textContent.trim();
        aqiElement.className = `text-6xl font-extrabold p-4 rounded-xl shadow-inner ${getColorClass(
          aqiValue
        )} inline-block`;
      };
    </script>
  </head>
  <body>
    <div class="min-h-screen bg-gray-50 p-6">
      <!-- BaÅŸlÄ±k ve Navigasyon -->
      <header class="bg-white shadow-md rounded-xl p-4 mb-6">
        <h1 class="text-3xl font-bold text-gray-800">TEMPO AQI Risk Paneli</h1>
        <nav class="mt-4 flex space-x-4 border-b pb-2">
          <a
            href="{{ url_for('aqi_panel') }}"
            class="nav-link active border-b-2 px-3 py-1"
            >Ã–zet (AQI)</a
          >
          <a
            href="{{ url_for('aqi_map_graph_panel') }}"
            class="nav-link hover:border-b-2 border-transparent px-3 py-1 text-gray-600 hover:text-indigo-600"
            >Harita & Grafik</a
          >
          <a
            href="{{ url_for('decision_support') }}"
            class="nav-link hover:border-b-2 border-transparent px-3 py-1 text-gray-600 hover:text-indigo-600"
            >Karar Destek</a
          >
          <a
            href="{{ url_for('data_sources') }}"
            class="nav-link hover:border-b-2 border-transparent px-3 py-1 text-gray-600 hover:text-indigo-600"
            >Veri KaynaklarÄ±</a
          >
        </nav>
      </header>

      <main>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Sol Panel: Ana Metrik -->
          <div
            class="lg:col-span-2 bg-white p-8 rounded-xl shadow-lg border-l-4 border-indigo-500"
          >
            <h2 class="text-xl font-semibold text-gray-700 mb-4">
              Ä°ÅŸlenen BÃ¶lgelerin Ortalama AQI Skoru
            </h2>
            <div class="flex items-center space-x-6">
              <span
                id="avgAqiScore"
                class="text-6xl font-extrabold p-4 rounded-xl shadow-inner"
              >
                {{ avg_aqi }}
              </span>
              <div class="text-gray-500">
                <p class="text-sm">
                  Hesaplanan tÃ¼m izleme zonlarÄ±nÄ±n ortalama risk seviyesini
                  gÃ¶sterir.
                </p>
                <p class="text-sm mt-1">
                  Son GÃ¼ncelleme:
                  <span class="font-medium text-gray-700"
                    >Tarih/Saat Bilgisi (YazÄ±lÄ±mla Eklenmeli)</span
                  >
                </p>
              </div>
            </div>

            <div class="mt-8">
              <h3 class="text-lg font-semibold text-gray-700 mb-3">
                Durum AÃ§Ä±klamasÄ±
              </h3>
              <p class="text-gray-600 p-3 bg-indigo-50 rounded-lg">
                AQI skoru, azot dioksit (NO2) konsantrasyonlarÄ±na gÃ¶re
                hesaplanmÄ±ÅŸtÄ±r. YÃ¼ksek skor, bÃ¶lgedeki hava kalitesinin hassas
                veya saÄŸlÄ±ksÄ±z olabileceÄŸini gÃ¶sterir.
              </p>
            </div>
          </div>

          <!-- SaÄŸ Panel: Eylem ve Kontrol -->
          <div
            class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-between"
          >
            <div>
              <h2 class="text-xl font-semibold text-gray-700 mb-4">
                Veri AkÄ±ÅŸÄ± KontrolÃ¼
              </h2>
              <p class="text-gray-600 mb-4 text-sm">
                En gÃ¼ncel TEMPO verilerini Ã§ekmek, AQI'yÄ± hesaplamak ve
                gÃ¶rselleÅŸtirmeleri oluÅŸturmak iÃ§in butona tÄ±klayÄ±n. Bu iÅŸlem
                biraz zaman alabilir.
              </p>
              <button
                id="updateButton"
                onclick="updateData()"
                class="w-full bg-green-600 text-white font-bold py-3 rounded-lg shadow-md hover:bg-green-700 transition duration-300 transform hover:scale-[1.02]"
              >
                ğŸ“¡ TEMPO Verilerini GÃ¼ncelle ve Ä°ÅŸle
              </button>
            </div>

            <div class="mt-6 pt-4 border-t">
              <h3 class="text-lg font-semibold text-gray-700 mb-2">
                HÄ±zlÄ± EriÅŸim
              </h3>
              <ul class="space-y-2">
                <li>
                  <a
                    href="{{ url_for('aqi_map_graph_panel') }}"
                    class="text-indigo-600 hover:text-indigo-800 text-sm"
                    >â†’ Harita ve GÃ¶rsel Analiz</a
                  >
                </li>
                <li>
                  <a
                    href="{{ url_for('decision_support') }}"
                    class="text-indigo-600 hover:text-indigo-800 text-sm"
                    >â†’ Eylem PlanlarÄ± ve Karar Destek</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
